<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTOMUNDOLAVADORAS</title>
    <style>
      .grid-fluid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }

      img {
        max-width: 100%;
        height: auto;
      }

      .producto {
        border: 1px solid #ccc;
        padding: 1rem;
        text-align: center;
      }

      .loader {
        display: block;
        margin: auto;
      }
    </style>
</head>
<body>
  <h1>BIENVENIDOS A MUNDOLAVADORAS</h1>
  <h2>¿QUÉ REPUESTO NECESITAS?</h2>
  <input type="search" id="search" placeholder="BUSCAR PRODUCTOS...">
  <section id="productos" class="grid-fluid"></section> 
  <template id="producto-template">
    <article class="producto">
      <h3 class="name"></h3>
      <img class="image" alt="Imagen del producto">
      <p class="price"></p>
      <p class="stock"></p>
    </article>
  </template> 

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const d = document,
            $search = d.getElementById("search"),
            $productos = d.getElementById("productos"),
            $template = d.getElementById("producto-template").content,
            $fragment = d.createDocumentFragment();

      const fetchProductos = async (query) => {
        try {
          // Usa tu URL aquí
          let api = `https://mundolavadoras.com/wp-json/wc/v3/products?search=${encodeURIComponent(query)}&consumer_key=ck_ac71f77112971d39f3e349dd4a2d0ffbafb21f7a&consumer_secret=cs_fb4fea0b0b698bc83365c2fccb73720003f8da4a`;
          let res = await fetch(api);

          if (!res.ok) throw { status: res.status, statusText: res.statusText };

          return await res.json();
        } catch (err) {
          console.error(`Error ${err.status}: ${err.statusText}`);
          $productos.innerHTML = `<h2>Error ${err.status}: ${err.statusText}</h2>`;
        }
      };

      const renderProductos = (productos) => {
        $productos.innerHTML = "";
        
        if (productos.length === 0) {
          $productos.innerHTML = "<h2>NO EXISTEN PRODUCTOS PARA ESTA BÚSQUEDA</h2>";
          return;
        }

        productos.forEach(producto => {
          $template.querySelector(".name").textContent = producto.name;
          $template.querySelector(".price").textContent = `Precio: ${producto.price}`;
          $template.querySelector(".stock").textContent = `Cantidad: ${producto.stock_quantity || 'No disponible'}`;
          $template.querySelector(".image").src = producto.images.length ? producto.images[0].src : '';
          
          let $clone = d.importNode($template, true);
          $fragment.appendChild($clone);
        });

        $productos.appendChild($fragment);
      };

      $search.addEventListener("keypress", async (e) => {
        if (e.key === "Enter") {
          let query = e.target.value.trim().toLowerCase();
          if (query === "") {
            $productos.innerHTML = "<h2>Por favor, ingresa un término de búsqueda</h2>";
            return;
          }

          let productos = await fetchProductos(query);

          if (productos) {
            renderProductos(productos);
          }
        }
      });
    });
  </script>
</body>
</html>